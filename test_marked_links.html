<!DOCTYPE html>
<html>
<head>
    <title>Test Marked.js Link Rendering</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .result { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; }
        a { color: #2563eb; }
        pre { background: #1e1e1e; color: #fff; padding: 15px; border-radius: 8px; overflow-x: auto; }
        h2 { color: #333; border-bottom: 2px solid #2563eb; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Marked.js Link Rendering Test</h1>

    <h2>Test Markdown Input</h2>
    <pre id="input"></pre>

    <h2>Rendered HTML Output</h2>
    <div id="output" class="result"></div>

    <h2>Raw HTML</h2>
    <pre id="raw-html"></pre>

    <script>
        // Test markdown with links (similar to what API returns)
        const testMarkdown = `## Apollo 11: Background Research

### I. Mission Overview

*   **Official Name:** Apollo 11
*   **Objective:** Achieve a crewed lunar landing.
    *   [NASA - Apollo 11 Mission Overview](https://www.nasa.gov/mission_pages/apollo/missions/apollo11.html)
*   **Launch Date:** July 16, 1969
    *   [NASA - Apollo 11 Launch](https://www.nasa.gov/mission_pages/apollo/apollo11.html)

### II. Crew

*   **Neil Armstrong (Commander):** First human to walk on the Moon.
    *   [NASA - Neil Armstrong Biography](https://www.nasa.gov/centers/glenn/about/bios/neil-armstrong.html)
*   **Buzz Aldrin (Lunar Module Pilot):** Second human to walk on the Moon.
    *   [NASA - Buzz Aldrin Biography](https://www.nasa.gov/centers/glenn/about/bios/buzz-aldrin.html)

### III. More Info

Visit [Wikipedia](https://en.wikipedia.org/wiki/Apollo_11) for more details.`;

        // Configure marked with custom renderer (same as in app)
        marked.setOptions({
            breaks: true,
            gfm: true
        });

        const renderer = new marked.Renderer();
        renderer.link = function(token) {
            let href, title, text;
            if (typeof token === 'object' && token !== null && 'href' in token) {
                href = token.href || '';
                title = token.title || '';
                text = token.text || href;
            } else {
                href = token || '';
                title = arguments[1] || '';
                text = arguments[2] || href;
            }
            const titleAttr = title ? ` title="${title}"` : '';
            return `<a href="${href}"${titleAttr} target="_blank" rel="noopener noreferrer">${text}</a>`;
        };
        marked.use({ renderer });

        // Display input
        document.getElementById('input').textContent = testMarkdown;

        // Parse and display
        const html = marked.parse(testMarkdown);
        document.getElementById('output').innerHTML = html;
        document.getElementById('raw-html').textContent = html;

        console.log('=== MARKED.JS TEST ===');
        console.log('Input markdown:', testMarkdown);
        console.log('Output HTML:', html);

        // Check if links are correct
        const links = document.querySelectorAll('#output a');
        console.log('Found', links.length, 'links:');
        links.forEach((link, i) => {
            console.log(`  ${i+1}. href="${link.href}" text="${link.textContent}"`);
        });
    </script>
</body>
</html>
